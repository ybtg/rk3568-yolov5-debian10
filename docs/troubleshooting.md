# Troubleshooting & Pitfalls

This section documents **real issues encountered during deployment** and the reasoning process behind the final working solution.
The goal is not only to show *what failed*, but *why it failed*.

---

## 1. Why I Switched from Buildroot to Debian 10

Initially, I deployed YOLOv5 on the **factory Buildroot system**.

However, I quickly ran into a major limitation:

* Buildroot does **not** provide a convenient package manager like `apt`
* Adding new software requires **rebuilding the entire system**
* This workflow was too heavy and inefficient for iterative development

Therefore, I decided to **switch the OS to Debian 10**, which provides:

* A complete package ecosystem
* Easier debugging and development
* Faster iteration

---

## 2. First Major Issue: GLIBC Version Mismatch

At that time, I had already cross-compiled the YOLOv5 demo on an **Ubuntu 20.04 virtual machine**, using:

* RKNN-Toolkit2 **1.4.0**
* RKNPU2 **1.4.0**

This was because the **earliest version available** in Rockchip’s official GitHub repository was 1.4.0.

When running the compiled binary on the Debian 10 board, the following error occurred:

```bash
root@ATK-DLRK3568-Debian:~/install/rknn_yolov5_demo_Linux# ./rknn_yolov5_demo model/RK356X/yolov5s-640-640.rknn model/1_rot268.jpg 
./rknn_yolov5_demo: /lib/aarch64-linux-gnu/libm.so.6: version `GLIBC_2.29' not found (required by ./rknn_yolov5_demo)
./rknn_yolov5_demo: /lib/aarch64-linux-gnu/libm.so.6: version `GLIBC_2.29' not found (required by lib/librga.so)
```

---

## 3. Root Cause Analysis (GLIBC)

This issue actually had **two layers**:

### 3.1 Cross-compiled Binary Issue

* The `rknn_yolov5_demo` executable was built on **Ubuntu 20.04**
* Ubuntu 20.04 uses **GLIBC ≥ 2.29**
* Debian 10 provides an **older GLIBC**

➡️ Result: the executable could not run on Debian 10.

To fix this, I recompiled **RKNPU2 1.4.0 directly on the board**.
After recompilation:

* The **first GLIBC error disappeared**
* The **second error remained**

---

### 3.2 RKNPU2 1.4.0 Toolchain Issue

After further investigation, I realized:

* Rockchip compiled **RKNPU2 1.4.0** using a **newer GLIBC**
* Even when compiled on the board, the linked libraries still required `GLIBC_2.29`
* Debian 10 simply could not satisfy this dependency

➡️ Conclusion:
**RKNPU2 1.4.0 is not compatible with Debian 10 at the GLIBC level**

---

## 4. Downgrading RKNPU2 to 1.3.0

To resolve this, I:

1. Cloned the `rknpu2` repository on **Windows**
2. Used Git to **roll back the version to 1.3.0**
3. Packaged `rknpu2-1.3.0`
4. Transferred it to the RK3568 board
5. Attempted to rebuild

---

## 5. CRLF Issue Caused by Windows

During the rebuild, another issue appeared:

* The script `build-linux_RK356X.sh` failed to run
* This was caused by **CRLF line endings** introduced on Windows

### Fix

Install `dos2unix` and convert the script:

```bash
apt install dos2unix -y
dos2unix build-linux_RK356X.sh
```

After this, the demo binary finally ran **without GLIBC errors**.

---

## 6. Runtime Failure: Abnormal Bounding Boxes

Even though the program now ran, inference still failed:

* A large number of bounding boxes were generated
* All boxes had **identical confidence**
* Box size was often **1 pixel**
* These invalid boxes overloaded the NPU and caused inference failure

At this point, I noticed:

* The RKNN model was generated using **RKNN-Toolkit2 1.4.0**
* The runtime was **RKNPU2 1.3.0**

➡️ Strong suspicion:
**Model–runtime version mismatch**

---

## 7. Root Cause: Toolkit and Runtime Version Mismatch

I concluded that:

* RKNN models generated by **higher toolkit versions**
* Are **not guaranteed to be compatible** with lower runtime versions

To fix this properly, I needed **RKNN-Toolkit2 1.3.0**.

---

## 8. Finding RKNN-Toolkit2 1.3.0 (The Hard Part)

My initial goal was to find a **complete release**, including:

* Toolkit
* Docker image
* Example files

However, this package was **not available** as a single official release.

Eventually, I found:

* **RKNN-Toolkit2 1.3.0 (no Docker)** on GitHub
* **RKNN-Toolkit2 1.3.0 Docker image** on Docker Hub

By combining these two sources, I was able to:

* Rebuild the **RKNN model using Toolkit 1.3.0**
* Recompile the demo with **RKNPU2 1.3.0**
* Run inference successfully on the board

This time, the program:

* Ran smoothly
* Generated a valid output image
* Produced correct detection results

---

## 9. Why This Repository Exists

This repository exists for two reasons:

1. To prevent **my future self** from forgetting this painful but valuable process
2. To help **other developers** who want to deploy YOLO on
   **RK3568 + Debian 10**, so they can **avoid these pitfalls**

If this documentation saves you even a few hours of debugging,
then this repository has fulfilled its purpose.